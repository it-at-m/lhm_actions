# https://vitepress.dev/guide/deploy#github-pages
name: "Build docs"
description: "Build docs with VitePress or VuePress"

inputs:
  docs-path:
    description: "Path to VitePress docs project"
    required: false
    default: "./docs"
  node-version:
    description: "Node version"
    required: false
    default: "22"
  build-cmd:
    description: "Build command to run (e.g. for VuePress use: vuepress build)"
    required: false
    default: "build"
  dist-path:
    description: "Output directory that will be uploaded to GitHub Pages"
    required: false
    default: ".vitepress/dist"

runs:
  using: "composite"
  steps:
    - name: Checkout repository
      uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0
      with:
        fetch-depth: 0 # Required for vitepress lastUpdated
    - name: Setup Node
      uses: actions/setup-node@a0853c24544627f65ddf259abe73b1d18a591444 # v5.0.0
      with:
        node-version: ${{ inputs.node-version }}
        cache: npm
        cache-dependency-path: "${{ inputs.docs-path }}/package-lock.json"
    - name: Setup Pages
      uses: actions/configure-pages@983d7736d9b0ae728b81ab479565c72886d7745b # v5
    - name: Install dependencies
      run: npm --prefix ./${{ inputs.docs-path }} ci
      shell: bash
    - name: Run lint
      run: npm run --prefix ./${{ inputs.docs-path }} lint
      shell: bash
    - name: Build with VitePress
      run: npm --prefix ./${{ inputs.docs-path }} run ${{ inputs.build-cmd }}
      shell: bash
    - name: Upload artifact
      uses: actions/upload-pages-artifact@56afc609e74202658d3ffba0e8f6dda462b719fa # v3.0.1
      with:
        path: ${{ inputs.docs-path }}/${{ inputs.dist-path }}
